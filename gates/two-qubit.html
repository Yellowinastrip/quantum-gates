<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Two-Qubit Gate Visualizer with Permutations</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .circle-container { position: relative; width: 260px; height: 260px; border: 2px dashed #d1d5db; border-radius: 50%; margin: 1rem auto; }
    .circle-point { position: absolute; transform: translate(-50%, -50%); }
  </style>
</head>
<body class="bg-light text-dark min-vh-100">
  <main class="container py-4">
    <header class="mb-4 text-center">
      <h1 class="h3">Two-Qubit Gate Visualizer</h1>
      <p class="text-muted">Select two inputs on circles, then apply a gate permutation. Output is expressed in the computational basis |00⟩, |01⟩, |10⟩, |11⟩ (without normalization).</p>
    </header>

    <!-- Circles and permutation selector -->
    <section class="d-flex justify-content-center gap-5 mb-4 flex-wrap">
      <div>
        <h2 class="h6 text-center">Input A</h2>
        <div class="circle-container" id="circleA"></div>
      </div>
      <div>
        <h2 class="h6 text-center">Input B</h2>
        <div class="circle-container" id="circleB"></div>
      </div>
      <div class="align-self-center">
        <h2 class="h6 text-center">Gate Permutation</h2>
        <select id="permSelect" class="form-select"></select>
      </div>
    </section>

    <!-- Gate and output visualization -->
    <section class="bg-white rounded shadow border p-3">
      <svg id="circuit" viewBox="0 0 900 260" class="w-100" style="min-width:680px">
        <defs>
          <marker id="arrow" viewBox="0 0 10 10" refX="7" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#6c757d"></path>
          </marker>
        </defs>

        <!-- Input wires -->
        <line x1="80" y1="90" x2="360" y2="90" stroke="#adb5bd" stroke-width="4" marker-end="url(#arrow)" />
        <line x1="80" y1="170" x2="360" y2="170" stroke="#adb5bd" stroke-width="4" marker-end="url(#arrow)" />

        <!-- Gate box -->
        <rect x="360" y="60" width="180" height="120" rx="16" ry="16" fill="#f8f9fa" stroke="#0d6efd" stroke-width="2" />
        <text id="gateLabel" x="450" y="120" text-anchor="middle" alignment-baseline="middle" font-size="16" fill="#212529">Permutation</text>

        <!-- Output wires -->
        <line x1="540" y1="90" x2="820" y2="90" stroke="#adb5bd" stroke-width="4" marker-end="url(#arrow)" />
        <line x1="540" y1="170" x2="820" y2="170" stroke="#adb5bd" stroke-width="4" marker-end="url(#arrow)" />

        <!-- Input bubbles -->
        <g>
          <rect x="10" y="60" width="120" height="60" rx="12" fill="#eef4ff" stroke="#0d6efd" />
          <text id="inputAText" x="70" y="90" text-anchor="middle" alignment-baseline="middle">|0⟩</text>
        </g>
        <g>
          <rect x="10" y="140" width="120" height="60" rx="12" fill="#eef4ff" stroke="#0d6efd" />
          <text id="inputBText" x="70" y="170" text-anchor="middle" alignment-baseline="middle">|0⟩</text>
        </g>

        <!-- Output bubble -->
        <g>
          <rect x="720" y="80" width="160" height="100" rx="12" fill="#ecfffd" stroke="#20c997" />
          <text id="outputText" x="800" y="130" text-anchor="middle" alignment-baseline="middle">|00⟩</text>
        </g>
      </svg>
    </section>

    <footer class="text-center text-muted small mt-4">Built with Bootstrap. No build tools required.</footer>
  </main>

  <script>
    const STATES = [
      { label: '|0⟩', a: 1, b: 0 },
      { label: '|0⟩+|1⟩', a: 1, b: 1 },
      { label: '|1⟩', a: 0, b: 1 },
      { label: '−|0⟩+|1⟩', a: -1, b: 1 },
      { label: '−|0⟩', a: -1, b: 0 },
      { label: '−|0⟩−|1⟩', a: -1, b: -1 },
      { label: '−|1⟩', a: 0, b: -1 },
      { label: '|0⟩−|1⟩', a: 1, b: -1 },
    ];

    const circleA = document.getElementById('circleA');
    const circleB = document.getElementById('circleB');
    const inputAText = document.getElementById('inputAText');
    const inputBText = document.getElementById('inputBText');
    const outputText = document.getElementById('outputText');
    const permSelect = document.getElementById('permSelect');

    let idxA = 0, idxB = 0;

    function generatePermutations(arr) {
      const result = [];
      function permute(a, m = []) {
        if (a.length === 0) result.push(m);
        else {
          for (let i = 0; i < a.length; i++) {
            let curr = a.slice();
            let next = curr.splice(i, 1);
            permute(curr.slice(), m.concat(next));
          }
        }
      }
      permute(arr);
      return result;
    }

    const allPerms = generatePermutations([0,1,2,3]);

    function populatePermSelect(){
      permSelect.innerHTML='';
      allPerms.forEach((p,i)=>{
        const opt=document.createElement('option');
        opt.value=i;
        opt.textContent=p.join(' ');
        permSelect.appendChild(opt);
      });
      permSelect.value=0;
    }

    function placeCirclePoints(circle, isA) {
      const r = 120; const cx = 130, cy = 130;
      STATES.forEach((state, i) => {
        const angle = (i / STATES.length) * 2 * Math.PI - Math.PI/2;
        const x = cx + r * Math.cos(angle);
        const y = cy + r * Math.sin(angle);

        const wrapper = document.createElement('div');
        wrapper.className = 'circle-point text-center';
        wrapper.style.left = x+'px';
        wrapper.style.top = y+'px';

        const input = document.createElement('input');
        input.type = 'radio';
        input.name = isA? 'stateA' : 'stateB';
        input.className = 'form-check-input';
        if(i===0) input.checked=true;

        input.addEventListener('change',()=>{
          if(isA) idxA=i; else idxB=i;
          updateView();
        });

        const label = document.createElement('label');
        label.className='d-block small';
        label.textContent = state.label;

        wrapper.appendChild(input);
        wrapper.appendChild(label);
        circle.appendChild(wrapper);
      });
    }

    function updateView(){
      inputAText.textContent = STATES[idxA].label;
      inputBText.textContent = STATES[idxB].label;

      const perm=allPerms[permSelect.value];

      const a=STATES[idxA], b=STATES[idxB];
      const vin=[a.a*b.a, a.a*b.b, a.b*b.a, a.b*b.b];
      const vout=[0,0,0,0];
      vin.forEach((val,i)=>{ vout[perm[i]]=val; });

      const basis=['|00⟩','|01⟩','|10⟩','|11⟩'];
      let repr = '';
      vout.forEach((c,i)=>{ if(c!==0){ if(repr!=='') repr+=' + '; repr+=(c===-1?'−':'')+basis[i]; } });
      if(repr==='') repr='0';
      outputText.textContent = repr;
    }

    placeCirclePoints(circleA,true);
    placeCirclePoints(circleB,false);
    populatePermSelect();
    permSelect.addEventListener('change',updateView);
    updateView();
  </script>
</body>
</html>
